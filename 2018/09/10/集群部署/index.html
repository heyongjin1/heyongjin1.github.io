<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>集群部署 | iTracing</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="iTracing">
    <meta name="author" content="zcm-itracing team">
    <meta name="description" content="调用链追踪技术" />
    <meta name="keywords" content="iTracing,iLog,iTuning" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="iTracing" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">iTracing</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2018-09-10T14:13:01.000Z" itemprop="datePublished">
          2018-09-10
      </time>
    
</span>
                <h1>集群部署</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>iTracing的collector收集数据并存入hbase，所以iTracing集群部署其实也就是hbase集群的部署</p>
<h1 id="一、Hbase集群部署"><a href="#一、Hbase集群部署" class="headerlink" title="一、Hbase集群部署"></a>一、Hbase集群部署</h1><h2 id="部署前准备工作"><a href="#部署前准备工作" class="headerlink" title="部署前准备工作"></a>部署前准备工作</h2><h3 id="主机规划"><a href="#主机规划" class="headerlink" title="主机规划"></a>主机规划</h3><table>
<thead>
<tr>
<th style="text-align:left">主机地址</th>
<th style="text-align:left">HostName</th>
<th style="text-align:left">Zookeeper</th>
<th style="text-align:left">HDFS</th>
<th style="text-align:left">HBase</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">10．45.61.61</td>
<td style="text-align:left">hbase1</td>
<td style="text-align:left">server</td>
<td style="text-align:left">NameNode</td>
<td style="text-align:left">Master</td>
</tr>
<tr>
<td style="text-align:left">10．45.61.62</td>
<td style="text-align:left">hbase2</td>
<td style="text-align:left">server</td>
<td style="text-align:left">DataNode，SecondaryNameNode</td>
<td style="text-align:left">RegionServer</td>
</tr>
<tr>
<td style="text-align:left">10．45.61.63</td>
<td style="text-align:left">hbase3</td>
<td style="text-align:left">server</td>
<td style="text-align:left">DataNode</td>
<td style="text-align:left">RegionServer</td>
</tr>
<tr>
<td style="text-align:left">10．45.61.64</td>
<td style="text-align:left">hbase4</td>
<td style="text-align:left">无</td>
<td style="text-align:left">DataNode</td>
<td style="text-align:left">RegionServer</td>
</tr>
</tbody>
</table>
<blockquote>
<p>这里是将hbase1选做主节点,hbase2、hbase3、hbase4作为从节点</p>
</blockquote>
<h3 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h3><p>habse集群的部署需要先部署Hadoop集群，因此需要下载以下安装包：</p>
<ol>
<li><strong>Hadoop</strong>：<a href="https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-2.7.6/hadoop-2.7.6.tar.gz" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-2.7.6/hadoop-2.7.6.tar.gz</a></li>
<li><strong>zookeeper</strong>：<a href="https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.4.12/zookeeper-3.4.12.tar.gz" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.4.12/zookeeper-3.4.12.tar.gz</a></li>
<li><strong>Hbase</strong>：<a href="http://archive.apache.org/dist/hbase/1.2.6/hbase-1.2.6-bin.tar.gz" target="_blank" rel="noopener">http://archive.apache.org/dist/hbase/1.2.6/hbase-1.2.6-bin.tar.gz</a></li>
</ol>
<h3 id="修改主机host信息"><a href="#修改主机host信息" class="headerlink" title="修改主机host信息"></a>修改主机host信息</h3><p>在每台主机上使用命令：<code>sudo vi /etc/hosts</code></p>
<p>并增加以下信息：</p>
<ul>
<li><code>10.45.61.61 hbase1</code></li>
<li><code>10.45.61.62 hbase2</code></li>
<li><code>10.45.61.63 hbase3</code></li>
<li><code>10.45.61.64 hbase4</code></li>
</ul>
<h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><p>将下载好的Hadoop,zookeeper,Hbase分别解压缩到<code>/hbase/hadoop</code>,<code>/hbase/zookeeper</code>,<code>/hbase/hbase</code>处；</p>
<p>并且在每台主机使用命令：vi  /etc/profile 打开配置文件，在里面增加以下配置信息：</p>
<ul>
<li><code>export HADOOP_HOME=/hbase/hadoop</code></li>
<li><code>export HBASE_HOME=/hbase/hbase</code></li>
<li><code>export PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$HBASE_HOME/bin</code></li>
<li><code>export HBASE_MANAGES_ZK=false</code></li>
</ul>
<p>最后使用命令：<code>source  /etc/profile</code>使配置文件生效。</p>
<h3 id="配置无密码访问"><a href="#配置无密码访问" class="headerlink" title="配置无密码访问"></a>配置无密码访问</h3><p>在hbase1主机上执行：</p>
<ul>
<li><code>ssh-keygen -t rsa -P &#39;&#39; -f ~/.ssh/id_rsa</code></li>
<li><code>scp～/.ssh/id_rsa.pub root@hbase2:~/</code></li>
<li><code>scp～/.ssh/id_rsa.pub root@hbase3:~/</code></li>
<li><code>scp～/.ssh/id_rsa.pub root@hbase4:~/</code></li>
</ul>
<p>在其余主机上执行：</p>
<ul>
<li><code>cat ~/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</code></li>
</ul>
<p>检查是否配置成功：在hbase1主机上执行命令：<code>ssh root@hbase2</code>如果出现<code>“password&quot;</code>则说明配置成功。</p>
<h2 id="集群部署"><a href="#集群部署" class="headerlink" title="集群部署"></a>集群部署</h2><h3 id="部署zookeeper"><a href="#部署zookeeper" class="headerlink" title="部署zookeeper"></a>部署zookeeper</h3><p>在hbase1、hbase2、hbase3上执行命令：</p>
<ul>
<li><code>cd  /hbase/zookeeper;</code></li>
<li><code>cp  zoo_sample.cfg  zoo.cfg ；</code></li>
<li><code>vi  zoo.cfg</code></li>
</ul>
<p>并在打开的<code>zoo.cfg</code>文件中增加如下配置：</p>
<ul>
<li><code>dataDir=/hbase/zookeeper/data</code></li>
<li><code>server.1=hbase1:2888:3888</code></li>
<li><code>server.2=hbase2:2888:3888</code></li>
<li><code>server.3=hbase3:2888:3888</code></li>
</ul>
<p>在<code>/hbase/zookeeper</code>下创建data目录，使用命令：<code>echo &quot;1&quot;&gt;/hbase/zookeeper/data/myid</code>  添加myid(其中hbase2，myid为2；hbase3,myid为3）</p>
<p>在bin目录下使用命令：<code>./zkServer.sh</code>启动zookeeper</p>
<h3 id="部署Hadoop集群"><a href="#部署Hadoop集群" class="headerlink" title="部署Hadoop集群"></a>部署Hadoop集群</h3><p>在每台主机<code>/habse/hadoop/etc/hadoop</code>目录下，分别找到如下配置文件并增加配置信息：<br> <strong> 1. core-site.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hbase1:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>2.hdfs-site.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/namedata<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/blockdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hbase2:50090<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>3.slaves</strong></p>
<p><code>hbase2</code></p>
<p><code>hbase3</code></p>
<p><code>hbase4</code></p>
<p>创建文件目录：</p>
<ul>
<li>在hbase1上执行：<code>mkdir -p /namedata</code></li>
<li>在hbase2~4上执行：<code>mkdir -p /blockdata</code></li>
</ul>
<p>在hbase1上执行命令：</p>
<ul>
<li><code>hdfs namenode -format</code>  格式化namenode元数据</li>
<li><code>start-dfs.sh</code>   启动hadoop集群</li>
</ul>
<p>访问<a href="http://hbase1:50070/" target="_blank" rel="noopener">http://hbase1:50070/</a>看是否启动正常</p>
<h3 id="部署Hbase集群"><a href="#部署Hbase集群" class="headerlink" title="部署Hbase集群"></a>部署Hbase集群</h3><p>在<code>/hbase/hbase/conf</code>路径下找到如下配置文件，并添加配置信息;</p>
<p><strong>1.hbase-site.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hbase1:9000/hbasedata<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hbase1:60000<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.info.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>60010<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hbase1:2181,hbase2:2181,hbase3:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>2.regionservers</strong></p>
<p><code>hbase2</code></p>
<p><code>hbase3</code></p>
<p><code>hbase4</code></p>
<p>在hbase1进入bin目录执行命令：<code>./start-hbase.sh</code> 启动hbase集群</p>
<p>访问<a href="http://hbase1:60010" target="_blank" rel="noopener">http://hbase1:60010</a> 查看集群是否启动成功，到此为止，集群才部署结束。</p>
<h2 id="二、iTracing部署"><a href="#二、iTracing部署" class="headerlink" title="二、iTracing部署"></a>二、iTracing部署</h2><h3 id="Hbase表创建"><a href="#Hbase表创建" class="headerlink" title="Hbase表创建"></a>Hbase表创建</h3><p>有两个脚本可用于为Pinpoint创建表：hbase-create.hbase和hbase-create-snappy.hbase。使用hbase-create-snappy.hbase进行快速压缩存储，否则请使用hbase-create.hbase。</p>
<p>使用命令：<code>/hbase/hbase/bin/hbase shell  hbase-create.hbase</code>  将执行脚本创建hbase表</p>
<h3 id="Collector部署"><a href="#Collector部署" class="headerlink" title="Collector部署"></a>Collector部署</h3><p>在任一主机上<a href="https://pan.baidu.com/s/1PodySiUv8DatZRWcO0HSyQ" target="_blank" rel="noopener">下载</a><code>pinpoint-collector-1.7.3.war</code>文件，并将该war包部署在tomcat中执行；</p>
<p>执行结束后，找到<code>collector.properties</code>和<code>hbase.properties</code>两个配置文件:</p>
<p><strong>1.collector.properties</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"># base data receiver config  ---------------------------------------------------------------------</span><br><span class="line">collector.receiver.base.ip=0.0.0.0</span><br><span class="line">collector.receiver.base.port=9994</span><br><span class="line"></span><br><span class="line"># number of tcp worker threads</span><br><span class="line">collector.receiver.base.worker.threadSize=8</span><br><span class="line"># capacity of tcp worker queue</span><br><span class="line">collector.receiver.base.worker.queueSize=1024</span><br><span class="line"># monitoring for tcp worker</span><br><span class="line">collector.receiver.base.worker.monitor=true</span><br><span class="line"></span><br><span class="line"># stat receiver config  ---------------------------------------------------------------------</span><br><span class="line">collector.receiver.stat.udp=true</span><br><span class="line">collector.receiver.stat.udp.ip=0.0.0.0</span><br><span class="line">collector.receiver.stat.udp.port=9995</span><br><span class="line">collector.receiver.stat.udp.receiveBufferSize=4194304</span><br><span class="line"></span><br><span class="line"># Should keep in mind that TCP transport load balancing is per connection.(UDP transport loadbalancing is per packet)</span><br><span class="line">collector.receiver.stat.tcp=false</span><br><span class="line">collector.receiver.stat.tcp.ip=0.0.0.0</span><br><span class="line">collector.receiver.stat.tcp.port=9995</span><br><span class="line"></span><br><span class="line"># number of udp statworker threads</span><br><span class="line">collector.receiver.stat.worker.threadSize=8</span><br><span class="line"># capacity of udp statworker queue</span><br><span class="line">collector.receiver.stat.worker.queueSize=64</span><br><span class="line"># monitoring for udp stat worker</span><br><span class="line">collector.receiver.stat.worker.monitor=true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># span receiver config  ---------------------------------------------------------------------</span><br><span class="line">collector.receiver.span.udp=true</span><br><span class="line">collector.receiver.span.udp.ip=0.0.0.0</span><br><span class="line">collector.receiver.span.udp.port=9996</span><br><span class="line">collector.receiver.span.udp.receiveBufferSize=4194304</span><br><span class="line"></span><br><span class="line"># Should keep in mind that TCP transport load balancing is per connection.(UDP transport loadbalancing is per packet)</span><br><span class="line">collector.receiver.span.tcp=false</span><br><span class="line">collector.receiver.span.tcp.ip=0.0.0.0</span><br><span class="line">collector.receiver.span.tcp.port=9996</span><br><span class="line"></span><br><span class="line"># number of udp statworker threads</span><br><span class="line">collector.receiver.span.worker.threadSize=32</span><br><span class="line"># capacity of udp statworker queue</span><br><span class="line">collector.receiver.span.worker.queueSize=256</span><br><span class="line"># monitoring for udp stat worker</span><br><span class="line">collector.receiver.span.worker.monitor=true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># configure l4 ip address to ignore health check logs</span><br><span class="line">collector.l4.ip=</span><br><span class="line"></span><br><span class="line"># change OS level read/write socket buffer size (for linux)</span><br><span class="line">#sudo sysctl -w net.core.rmem_max=</span><br><span class="line">#sudo sysctl -w net.core.wmem_max=</span><br><span class="line"># check current values using: </span><br><span class="line">#$ /sbin/sysctl -a | grep -e rmem -e wmem</span><br><span class="line"></span><br><span class="line"># number of agent event worker threads</span><br><span class="line">collector.agentEventWorker.threadSize=4</span><br><span class="line"># capacity of agent event worker queue</span><br><span class="line">collector.agentEventWorker.queueSize=1024</span><br><span class="line"></span><br><span class="line">statistics.flushPeriod=1000</span><br><span class="line"></span><br><span class="line"># -------------------------------------------------------------------------------------------------</span><br><span class="line"># The cluster related options are used to establish connections between the agent, collector, and web in order to send/receive data between them in real time.</span><br><span class="line"># You may enable additional features using this option (Ex : RealTime Active Thread Chart).</span><br><span class="line"># -------------------------------------------------------------------------------------------------</span><br><span class="line"># Usage : Set the following options for collector/web components that reside in the same cluster in order to enable this feature.</span><br><span class="line"># 1. cluster.enable (pinpoint-web.properties, pinpoint-collector.properties) - &quot;true&quot; to enable</span><br><span class="line"># 2. cluster.zookeeper.address (pinpoint-web.properties, pinpoint-collector.properties) - address of the ZooKeeper instance that will be used to manage the cluster</span><br><span class="line"># 3. cluster.web.tcp.port (pinpoint-web.properties) - any available port number (used to establish connection between web and collector)</span><br><span class="line"># -------------------------------------------------------------------------------------------------</span><br><span class="line"># Please be aware of the following:</span><br><span class="line">#1. If the network between web, collector, and the agents are not stable, it is advisable not to use this feature.</span><br><span class="line">#2. We recommend using the cluster.web.tcp.port option. However, in cases where the collector is unable to establish connection to the web, you may reverse this and make the web establish connection to the collector.</span><br><span class="line">#   In this case, you must set cluster.connect.address (pinpoint-web.properties); and cluster.listen.ip, cluster.listen.port (pinpoint-collector.properties) accordingly.</span><br><span class="line">cluster.enable=false</span><br><span class="line">cluster.zookeeper.address=localhost</span><br><span class="line">cluster.zookeeper.sessiontimeout=30000</span><br><span class="line">cluster.listen.ip=</span><br><span class="line">cluster.listen.port=</span><br><span class="line"></span><br><span class="line">#collector.admin.password=</span><br><span class="line">#collector.admin.api.rest.active=</span><br><span class="line">#collector.admin.api.jmx.active=</span><br><span class="line"></span><br><span class="line">collector.spanEvent.sequence.limit=10000</span><br><span class="line"></span><br><span class="line"># Flink configuration</span><br><span class="line">flink.cluster.enable=true</span><br><span class="line">flink.cluster.zookeeper.address=hbase1</span><br><span class="line">flink.cluster.zookeeper.sessiontimeout=3000</span><br></pre></td></tr></table></figure>
<p><strong>2.hbase.properties</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">hbase.client.host=hbase1,hbase2,hbase3</span><br><span class="line">hbase.client.port=2181</span><br><span class="line"></span><br><span class="line"># hbase default:/hbase</span><br><span class="line">hbase.zookeeper.znode.parent=/hbase</span><br><span class="line"></span><br><span class="line"># hbase namespace to use default:default</span><br><span class="line">hbase.namespace=default</span><br><span class="line"></span><br><span class="line"># hbase timeout option==================================================================================</span><br><span class="line"># hbase default:true</span><br><span class="line">hbase.ipc.client.tcpnodelay=true</span><br><span class="line"># hbase default:60000</span><br><span class="line">hbase.rpc.timeout=10000</span><br><span class="line"># hbase default:Integer.MAX_VALUE</span><br><span class="line">hbase.client.operation.timeout=10000</span><br><span class="line"></span><br><span class="line"># hbase socket read timeout. default: 200000</span><br><span class="line">hbase.ipc.client.socket.timeout.read=20000</span><br><span class="line"># socket write timeout. hbase default: 600000</span><br><span class="line">hbase.ipc.client.socket.timeout.write=60000</span><br><span class="line"></span><br><span class="line"># ==================================================================================</span><br><span class="line"># hbase client thread pool option</span><br><span class="line">hbase.client.thread.max=64</span><br><span class="line">hbase.client.threadPool.queueSize=5120</span><br><span class="line"># prestartAllCoreThreads</span><br><span class="line">hbase.client.threadPool.prestart=false</span><br><span class="line"></span><br><span class="line"># enable hbase async operation. default: false</span><br><span class="line">hbase.client.async.enable=false</span><br><span class="line"># the max number of the buffered asyncPut ops for each region. default:10000</span><br><span class="line">hbase.client.async.in.queuesize=10000</span><br><span class="line"># periodic asyncPut ops flush time. default:100</span><br><span class="line">hbase.client.async.flush.period.ms=100</span><br><span class="line"># the max number of the retry attempts before dropping the request. default:10</span><br><span class="line">hbase.client.async.max.retries.in.queue=10</span><br></pre></td></tr></table></figure>
<p>### </p>
<h3 id="web部署"><a href="#web部署" class="headerlink" title="web部署"></a>web部署</h3><p>在任一主机上<a href="https://pan.baidu.com/s/1kGeveY46bZ6pfbxdilYq6A" target="_blank" rel="noopener">下载</a><code>pinpoint-web-1.7.3.war</code> 文件，并将该war包部署在tomcat中执行；</p>
<p>这里只需要修改<code>hbase.properties</code>配置文件，且内容与collector中的<code>hbase.properties</code>文件内容相同</p>
<p>### </p>
<h3 id="agent部署"><a href="#agent部署" class="headerlink" title="agent部署"></a>agent部署</h3><p><a href="https://pan.baidu.com/s/13Zo2gjuKlcBroTjs23EhcA" target="_blank" rel="noopener">下载</a><code>pinpoint-agent-1.7.3.tar.gz</code>文件，并解压；</p>
<p>Pinpoint Agent作为附加到要分析的应用程序的Java代理运行（例如Tomcat）。</p>
<p>要连接代理，请在运行应用程序时将<code>$ AGENT_PATH/pinpoint-bootstrap-1.7.3.jar</code>传递给<code>-javaagent</code> JVM参数：</p>
<ul>
<li><code>-javaagent:$AGENT_PATH/pinpoint-bootstrap-1.7.3.jar</code></li>
</ul>
<p>此外，Pinpoint Agent需要2个命令行参数才能在分布式系统中识别自身：</p>
<ul>
<li><code>-Dpinpoint.agentId</code> - 唯一标识运行代理程序的应用程序实例</li>
<li><code>-Dpinpoint.applicationName</code> - 将多个相同的应用程序实例组合为一个服务</li>
</ul>
<p>请注意，<code>pinpoint.agentId</code>必须全局唯一以标识应用程序实例，并且共享相同<code>pinpoint.applicationName</code>的所有应用程序都被视为单个服务的多个实例。</p>
<p>在Tomcat启动脚本（<code>catalina.sh</code>）中将<code>-javaagent</code>，<code>-Dpinpoint.agentId</code>，<code>-Dpinpoint.applicationName</code>添加到<code>CATALINA_OPTS</code>，看如下示例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AGENT_PATH=<span class="string">"/Users/heyongjin/Documents/soft/pinpoint-agent-1.7.2-SNAPSHOT"</span></span><br><span class="line">AGENT_ID=<span class="string">"crm-tomcat01"</span></span><br><span class="line">APPLICATION_NAME=<span class="string">"crm-tomcat"</span></span><br><span class="line">CATALINA_OPTS =“$ CATALINA_OPTS -javaagent：$ AGENT_PATH / pinpoint-bootstrap-1.7.3.jar”</span><br><span class="line">CATALINA_OPTS =“$ CATALINA_OPTS -Dpinpoint.agentId = $ AGENT_ID”</span><br><span class="line">CATALINA_OPTS =“$ CATALINA_OPTS -Dpinpoint.applicationName = $ APPLICATION_NAME”</span><br></pre></td></tr></table></figure>
<p>针对<code>$ AGENT_PATH / pinpoint.config</code>中的 Pinpoint Agent提供了各种配置选项。<br>大多数这些选项都是不言自明的，但您必须检查的最重要的配置选项是收集器IP地址和TCP / UDP端口。这些值是代理建立到收集器的连接并正常工作所必需的值。</p>
<p>在<code>pinpoint.config</code>中适当地设置这些值：</p>
<ul>
<li><code>profiler.collector.ip （默认：127.0.0.1，建议使用域名）</code></li>
<li><code>profiler.collector.tcp.port（collector&#39;s collector.tcpListenPort - 默认值：9994）</code></li>
<li><code>profiler.collector.stat.port（collector&#39;s collector.udpStatListenPort - 默认：9995）</code></li>
<li><code>profiler.collector.span.port（collector&#39;s collector.udpSpanListenPort - 默认值：9996）</code></li>
</ul>
<p><code></code></p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    <a class="pull-left" href="/2018/09/10/操作手册/" style="float: left;">
        ← 操作手册
    </a>
    
    
    <a class="pull-right" href="/2018/09/10/快速开始/">
        快速开始 →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By zcm-itracing team. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
